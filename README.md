# availability-checker-go

**availability-checker-go** – это утилита для тестирования стратегий обхода DPI (Deep Packet Inspection), переписанная на Go для повышения производительности и надёжности. Программа изначально была реализована в виде batch‑скрипта, а данная версия использует возможности Go для параллельного выполнения HTTP‑запросов и управления внешними процессами.

## Особенности

- **Параллельное выполнение HTTP‑запросов.**  
  Использование встроенного HTTP‑клиента Go для тестирования доступности URL с настраиваемым таймаутом.

- **Тестирование стратегий обхода DPI.**  
  Загружает список стратегий из текстового файла и для каждой стратегии запускает внешний процесс (например, `goodbyedpi.exe`, `winws.exe` или `ciadpi.exe`).

- **Автоматическое определение ISP's Google Cache Server.**  
  Извлекает cluster codename с помощью report‑mapping URL и вычисляет автоадрес Google Cache Server.

- **Поддержка нескольких провайдеров.**  
  Поддерживаются внешние программы:
    - `gdpi` (GoodbyeDPI)
    - `zapret` (Zapret)
    - `cia` (ByeDPI)

- **Логирование.**  
  Программа записывает подробный лог как в консоль, так и в отдельный файл (сохраняется в папке `Logs` с меткой времени).

## Требования

- **Go.** Рекомендуется использовать версию Go 1.16 и выше.
- **Внешние исполняемые файлы.**  
  Для корректной работы необходимо, чтобы в рабочей папке (или по указанным в конфигурации путям) находились:
    - `goodbyedpi.exe` для провайдера `gdpi`
    - `winws.exe` для провайдера `zapret`
    - `ciadpi.exe` для провайдера `cia`

- **Файлы стратегий и чеклисты.**  
  Стратегии и дополнительные URL (чеклисты) должны храниться в виде текстовых файлов, где каждая строка содержит одну стратегию или URL.

## Установка

1. **Клонирование репозитория или загрузка исходного кода.**

2. **Компиляция:**

   Откройте терминал в директории с исходниками и выполните команду:
   ```bash
   go build -o goodcheck main.go
   ```
Это создаст исполняемый файл `goodcheck` (на Windows – `goodcheck.exe`).

## Конфигурация

Основные параметры приложения задаются в структуре `Config` в файле `main.go`. Вы можете изменить их напрямую в коде или расширить программу для чтения конфигурации из файла/переменных окружения.

Примеры основных параметров:

- **Общие настройки:**
    - `SkipAutoISPsGCS` – пропустить автоматическое определение ISP's Google Cache Server.
    - `SkipAutoTLS12BreakageTest` – пропустить тест TLS 1.2.
    - `CurlMinTimeout` – минимальный таймаут для HTTP‑запросов.

- **Папки и файлы:**
    - `MostSuccessfulStrategiesFile` – имя файла для записи самых успешных стратегий.
    - `CheckListFolder`, `StrategiesFolder`, `LogsFolder` – папки для чеклистов, стратегий и логов соответственно.

- **Стратегия:**
    - `FakeSNI`, `FakeHexRaw`, `PayloadTLS`, `PayloadQuic` – параметры, используемые в стратегиях.

- **Тестовые URL:**
    - `NetConnTestURL` и `TLS12TestURL` – URL для проверки базовой сетевой доступности и теста TLS 1.2.

- **Провайдеры:**
    - `GdpiExeName`, `ZapretExeName`, `CiaExeName` – имена (или пути) к внешним программам.  
      **Важно:** Если возникает ошибка вида `cannot run executable found relative to current directory`, убедитесь, что исполняемый файл находится в рабочей директории или укажите полный путь, например:
      ```
        config.ZapretExeName = `C:\path\to\winws.exe`
      ```

## Использование

Программа принимает следующие флаги командной строки:

- `-provider` – выбирает провайдера для тестирования. Допустимые значения: `gdpi`, `zapret`, `cia`.
- `-passes` – количество проходов тестирования (по умолчанию 1).
- `-strategy` – путь к файлу со списком стратегий.
- `-checklist` – (необязательно) путь к файлу с дополнительными URL для проверки.

### Пример запуска

```bash
./goodcheck -provider=zapret -passes=1 -strategy="D:\N\Strategies\Zapret\my.txt" -checklist="D:\N\CheckLists\list-discord.txt"
```

Если флаги не указаны, приложение запросит необходимую информацию в интерактивном режиме.

## Логирование

- Логирование ведётся одновременно в консоль и в файл.
- Лог-файлы сохраняются в папке `Logs` с именем формата:  
  `availability_check_<YYYY-MM-DD_HH-MM-SS>.txt`

## Примеры ошибок и их решение

### Ошибка запуска внешнего процесса

```
Ошибка запуска процесса winws.exe : exec: "winws.exe": cannot run executable found relative to current directory
```

**Причина:**  
Go не может найти исполняемый файл `winws.exe` относительно текущей рабочей директории.

**Решение:**
- Убедитесь, что файл `winws.exe` находится в той же папке, что и приложение, или
- Измените конфигурацию, указав полный путь к файлу:
  ```
  config.ZapretExeName = `C:\zapret-discord-youtube-1.6.2\bin\winws.exe`
  ```

### Отсутствие стратегий или URL для проверки

Убедитесь, что файлы, указанные в параметрах `-strategy` и `-checklist`, существуют и содержат корректные данные.

## Лицензия

**MIT**.

## Благодарности

Проект основан на оригинальном batch‑скрипте, созданном Ori. Данная версия написана на Go для повышения производительности и надёжности работы.

---

Если возникнут вопросы или предложения по улучшению, пожалуйста, создавайте issues или pull request.
